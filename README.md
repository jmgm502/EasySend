# 轻松传 - 文件传输网站

一个现代化的文件传输网站，支持在线实时传输和离线云端传输。

## 功能特性

### 📁 **多种传输类型**
- **文件传输**：支持多文件上传，单次最多10个文件
- **文本传输**：快速传输文本内容
- **屏幕截图**：实时截取屏幕或窗口
- **视频传输**：支持视频文件上传和传输

### 🚀 **传输模式**
- **在线传输**：实时P2P传输，速度更快，需要双方同时在线
- **离线传输**：云端中转存储，支持异地传输，24小时有效

### ✨ **核心功能**
- 拖拽上传支持
- 提取码接收机制
- 实时传输进度
- 响应式设计
- 屏幕截图功能
- 文件预览
- 传输历史记录

### 🎛️ **传输控制功能**
- **发送方关闭传送**：发送方可随时停止正在进行的传输
- **断开所有传送**：一键断开所有活跃的传输连接
- **接收方关闭传送**：接收方可主动停止接收文件
- **传输控制面板**：实时查看和管理所有传输状态
- **传输暂停/恢复**：支持暂停和恢复传输过程
- **传输历史管理**：查看和管理传输历史记录

## 技术架构

### 前端技术
- **HTML5**：现代化的页面结构
- **CSS3**：精美的界面设计和动画效果
- **JavaScript ES6+**：交互逻辑和文件处理
- **Socket.IO Client**：实时通信

### 后端技术
- **Node.js**：服务器运行环境
- **Express.js**：Web框架
- **Socket.IO**：实时双向通信
- **Multer**：文件上传处理
- **CORS**：跨域资源共享

## 快速开始

### 环境要求
- Node.js 14.0.0 或更高版本
- npm 包管理器

### 安装步骤

1. **克隆项目**
```bash
git clone <项目地址>
cd 轻松传
```

2. **安装依赖**
```bash
npm install
```

3. **启动服务器**
```bash
npm start
```

或者直接运行启动脚本：
```bash
# Windows
start.bat

# Linux/Mac
chmod +x start.sh
./start.sh
```

4. **访问网站**
打开浏览器访问：http://localhost:3000

## 使用说明

### 发送文件

1. **选择传输类型**
   - 点击对应的选项卡（传文件、传文本、传屏幕、传视频）

2. **上传内容**
   - **文件**：点击上传区域或拖拽文件
   - **文本**：在文本框中输入内容
   - **屏幕**：点击截屏按钮
   - **视频**：选择视频文件

3. **选择传输模式**
   - **发在线**：实时传输，需要接收方同时在线
   - **发离线**：云端存储，24小时内有效

4. **获取提取码**
   - 传输成功后会生成6位提取码
   - 将提取码分享给接收方

5. **传输控制**
   - 点击"传输控制"按钮打开控制面板
   - 可以停止、暂停或恢复传输
   - 查看传输进度和状态

### 接收文件

1. **输入提取码**
   - 在页面顶部输入6位提取码

2. **点击接收**
   - 系统会验证提取码并显示文件信息

3. **下载文件**
   - 点击下载按钮获取文件

4. **接收控制**
   - 接收过程中可以停止传输
   - 查看接收进度和状态

### 传输控制面板

1. **打开控制面板**
   - 点击"传输控制"按钮
   - 或使用快捷键 `Ctrl+Shift+C`

2. **管理传输**
   - 查看所有活跃传输状态
   - 停止指定传输
   - 暂停/恢复传输
   - 断开所有传输

3. **查看历史**
   - 点击"传输历史"查看过往记录
   - 清空历史记录

## API接口

### 上传接口
```
POST /api/upload
Content-Type: multipart/form-data

参数：
- type: 传输类型 (file/text/screen/video)
- isOnline: 是否在线传输 (true/false)
- files: 文件数据（文件类型）
- textContent: 文本内容（文本类型）
```

### 类型检测接口
```
GET /api/info/:code

返回：
{
  "success": true,
  "transferType": "offline" | "online" | "unknown" | "expired" | "exhausted",
  "data": {
    "code": "ABC123",
    "type": "file" | "text" | "screen" | "video",
    "isOnline": false,
    "fileCount": 2,
    "totalSize": 1024000,
    "textLength": 100,
    "textPreview": "文本预览..."
  }
}
```

### 接收接口
```
GET /api/receive/:code

返回：
{
  "success": true,
  "data": {
    "type": "file",
    "files": [...],
    "textContent": "...",
    "isOnline": false
  }
}
```

### 下载接口
```
GET /api/download/:code/:filename
```

### 状态查询
```
GET /api/status/:code
```

## Socket.IO事件

### 客户端发送
- `join-online-transfer`: 加入在线传输房间
- `prepare-transfer`: 准备传输数据
- `file-chunk`: 发送文件数据块
- `transfer-complete`: 传输完成

### 服务端发送
- `transfer-ready`: 传输准备就绪
- `file-chunk`: 接收文件数据块
- `transfer-complete`: 传输完成
- `user-disconnected`: 用户断开连接

## 文件结构

```
轻松传/
├── index.html          # 主页面
├── style.css           # 样式文件
├── script.js           # 前端脚本
├── server.js           # 后端服务器
├── package.json        # 项目配置
├── start.bat           # Windows启动脚本
├── README.md           # 项目说明
└── uploads/            # 文件上传目录（自动创建）
```

## 配置说明

### 文件大小限制
- 单个文件：最大10GB
- 单次传输：最多10个文件
- 视频文件：最大100MB（前端限制）

### 传输限制
- 离线传输：24小时有效期
- 最大下载次数：10次
- 提取码：6位字母数字组合

### 端口配置
默认端口：3000
可通过环境变量修改：
```bash
PORT=8080 npm start
```

## 浏览器兼容性

### 支持的浏览器
- Chrome 60+
- Firefox 55+
- Safari 12+
- Edge 79+

### 功能要求
- File API 支持
- WebSocket 支持
- Screen Capture API（屏幕截图功能）
- Clipboard API（复制功能）

## 安全特性

- 文件自动清理（过期删除）
- 下载次数限制
- 文件类型验证
- 大小限制保护
- CORS 跨域保护

## 开发说明

### 开发模式
```bash
npm run dev  # 使用nodemon自动重启
```

### 目录权限
确保uploads目录有写入权限：
```bash
chmod 755 uploads/
```

### 日志查看
服务器日志会显示：
- 用户连接状态
- 文件上传信息
- 传输房间状态
- 错误信息

## 常见问题

### Q: 上传失败怎么办？
A: 检查文件大小是否超限，网络连接是否正常

### Q: 提取码无效？
A: 确认提取码正确，检查是否已过期。对于在线传输，确保发送方仍在线且网络连接正常

### Q: 在线传输连接不上？
A: 确保双方都在线，检查网络防火墙设置

### Q: 屏幕截图不工作？
A: 需要浏览器支持Screen Capture API，并授予权限

## 更新日志

### v1.2.1 (最新)
- � 新增接收码方停止接收功能
- �️ 传输别控制中心支持接收方操作
- � 提区分发送方和接收方的停止操作
- 💬 优化停止传输的消息提示
- 🎨 为不同角色的停止按钮添加不同样式

### v1.2.0
- 🚀 新增提取码类型检测API (`/api/info/:code`)
- 🎯 智能识别传输类型，避免盲目尝试所有方法
- 📊 提供传输详细信息预览（文件数量、大小、文本长度等）
- ⚡ 优化接收逻辑，根据类型直接调用对应方法
- 🔍 改进错误分类和提示准确性

### v1.1.1
- 🐛 修复在线文本传输提取码无效问题
- 🔧 改进在线/离线传输识别逻辑
- ⏱️ 添加连接超时机制（15秒）
- 💬 优化错误提示信息
- 🧪 新增测试页面验证修复效果

### v1.1.0
- ✨ 新增传输控制功能
- 🛑 发送方关闭传送功能
- 🔌 断开所有传送功能
- 📱 接收方关闭传送功能
- 🎛️ 传输控制面板
- ⏸️ 传输暂停/恢复功能
- 📊 实时传输状态监控
- 📜 传输历史管理
- 🎨 界面美观度优化
- ⌨️ 快捷键支持 (Ctrl+Shift+C)

### v1.0.0
- 基础文件传输功能
- 在线/离线传输模式
- 屏幕截图功能
- 响应式界面设计
- Socket.IO实时通信

## 许可证

MIT License

## 贡献

欢迎提交Issue和Pull Request来改进项目。

## 联系方式

如有问题或建议，请通过以下方式联系：
- 邮箱：support@example.com